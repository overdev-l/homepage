---
title: monorepo工程化实践
date: 2023-03-30
description: Monorepo是一种在单个版本控制库中管理多个项目的方法，可简化代码共享和依赖管理，提高开发效率和代码质量。本文记录monorepo的工程化实践
---
### 背景
因当下场景需要快速创建项目，目前参考了`vite`、`astro`等脚手架的工程化实践，记录下本次monorepo工程化实践。废话不多说下面开始👇

### monorepo项目搭建
有关于什么是`monorepo`这里不过多赘述，有兴趣可以点击[博客](https://semaphoreci.com/blog/what-is-monorepo)查看，我个人推荐使用`pnpm`作为包管理工具，因为`pnpm`的特性可以很好的解决`monorepo`的依赖管理问题，这里不过多赘述，有兴趣可以点击[博客](https://www.pnpm.io/monorepos)查看。

我个人推荐使用`pnpm`创建项目，相关细节请移步[pnpm monorepo](https://pnpm.io/zh/workspaces)查看。

### 初始化项目
```bash
mkdir terky
cd terky
pnpm init
```
> 新建`pnpm-workspace.yaml`文件，配置`packages`目录下的所有包
```yaml
packages:
  - 'packages/*'
```
因为这个项目是一个脚手架，所以不仅要有脚手架包，还要有模板包,这是我的项目目录结构
```plantuml
├─packages
│  ├─create-terky
│  ├─template-react-ts
│  ├─template-vue3-ts
│  ├─template-vue3
│  └─template-vue2

```

### `eslint`
> 此配置作为基础配置，会被`packages`下的包继承
- eslint
`eslint`核心包
- @typescript-eslint/parser
`eslint`解析器，用于解析`typescript`代码
- @typescript-eslint/eslint-plugin
`eslint`插件，用于检查`typescript`代码
```bash
pnpm add eslint -D -w
pnpm add @typescript-eslint/parser -D -w
pnpm add @typescript-eslint/eslint-plugin -D -w
```
> 新建`.eslintrc.json`文件，配置`eslint`
```json
{
  "parser": "@typescript-eslint/parser",
  "env": {
    "es6": true
  },
  "extends": [
      "eslint:recommended",
      "plugin:@typescript-eslint/recommended"
  ],
  "parserOptions": {
    "sourceType": "module",
    "ecmaVersion": 2021
  },
  "rules": {

  }
}
```

### `commit规范`

首先全局安装 `commitizen`，这样可以在本地使用`cz`或`git cz`替代`git commit`
```bash
pnpm add -g commitizen
```
目前有很多`commit`工具帮助我们进行规范化`commit`格式，关于`commit`规范你可以点击这里[查看](https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)
推荐使用`cz-git`，官方提供了`commit`规范模版，以及支持`emoji`、中文英文双语，而且官网也是中文描述
```bash
pnpm add cz-git -D -w
```
具体如何配置，请移步官网文档查看，写的很清楚，可以直接选择喜欢的配置模版直接使用，建议搭配`commitlint`使用。安装完成后向`.commitlintrc.js`添加检测规则
```json
{
  ...
  extends: ['@commitlint/config-conventional']
  ...
}
```
添加`scripts`脚本命令
```json
{
  "scripts": {
    "commitlint": "commitlint --config .commitlintrc.js -e -V"
  }
}
```
`commitlint`需要搭配`husky`，需要添加commit-msg hooks
```bash
pnpm add husky @commitlint/{config-conventional,cli} -D -w
husky install
npx husky add .husky/commit-msg 'npm run commitlint'
```
### 创建模版项目
以上的配置只是为了规范项目的信息及代码格式，既然是脚手架项目那么就需要项目模版，目前规划5种模版项目:
> 以下项目的打包工具均为`webpack`
- vue3 + ts
- vue3 
- react + ts
- react
- vue2

### vue3 + ts 项目创建
> 因为是模版项目所以不能去共用`monorepo`的依赖，避免使用脚手架创建项目后出现依赖错误

安装依赖`webpack`相关依赖
```bash
pnpm add -D webpack webpack-cli webpack-merge webpack-dev-server 
```
安装vue相关依赖
```bash
pnpm add vue vue-router pinia -S
pnpm add vue-tsc vue-loader -D
```
配置`typescript`
```bash
pnpm add typescript -D
tsc --init
```
这里给出我目前采用的`tsconfig.json`的配置
```json
{
  "compilerOptions": {
    "target": "esnext",
    "module": "esnext",
    "strict": true,
    "jsx": "preserve",
    "moduleResolution": "node",
    "strictNullChecks": false,
    "paths": { "@/*":["./src/*"] },
    "allowSyntheticDefaultImports": true,
    "types": ["element-plus/global", "node"],
    "skipLibCheck": true,
    "noImplicitAny": false
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue", "test/**/*.test.ts"],

```
模版的`eslint`与`commitlint`就不再说一遍了,只列出依赖。
```bash
pnpm add eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-plugin-vue eslint-webpack-plugin eslint-plugin-vuefix -D
```
