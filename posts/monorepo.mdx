---
title: monorepoå·¥ç¨‹åŒ–å®è·µ
date: 2023-03-30
description: Monorepoæ˜¯ä¸€ç§åœ¨å•ä¸ªç‰ˆæœ¬æ§åˆ¶åº“ä¸­ç®¡ç†å¤šä¸ªé¡¹ç›®çš„æ–¹æ³•ï¼Œå¯ç®€åŒ–ä»£ç å…±äº«å’Œä¾èµ–ç®¡ç†ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚æœ¬æ–‡è®°å½•monorepoçš„å·¥ç¨‹åŒ–å®è·µ
---
### èƒŒæ™¯
å› å½“ä¸‹åœºæ™¯éœ€è¦å¿«é€Ÿåˆ›å»ºé¡¹ç›®ï¼Œç›®å‰å‚è€ƒäº†`vite`ã€`astro`ç­‰è„šæ‰‹æ¶çš„å·¥ç¨‹åŒ–å®è·µï¼Œè®°å½•ä¸‹æœ¬æ¬¡monorepoå·¥ç¨‹åŒ–å®è·µã€‚åºŸè¯ä¸å¤šè¯´ä¸‹é¢å¼€å§‹ğŸ‘‡

### monorepoé¡¹ç›®æ­å»º
æœ‰å…³äºä»€ä¹ˆæ˜¯`monorepo`è¿™é‡Œä¸è¿‡å¤šèµ˜è¿°ï¼Œæœ‰å…´è¶£å¯ä»¥ç‚¹å‡»[åšå®¢](https://semaphoreci.com/blog/what-is-monorepo)æŸ¥çœ‹ï¼Œæˆ‘ä¸ªäººæ¨èä½¿ç”¨`pnpm`ä½œä¸ºåŒ…ç®¡ç†å·¥å…·ï¼Œå› ä¸º`pnpm`çš„ç‰¹æ€§å¯ä»¥å¾ˆå¥½çš„è§£å†³`monorepo`çš„ä¾èµ–ç®¡ç†é—®é¢˜ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜è¿°ï¼Œæœ‰å…´è¶£å¯ä»¥ç‚¹å‡»[åšå®¢](https://www.pnpm.io/monorepos)æŸ¥çœ‹ã€‚

æˆ‘ä¸ªäººæ¨èä½¿ç”¨`pnpm`åˆ›å»ºé¡¹ç›®ï¼Œç›¸å…³ç»†èŠ‚è¯·ç§»æ­¥[pnpm monorepo](https://pnpm.io/zh/workspaces)æŸ¥çœ‹ã€‚

### åˆå§‹åŒ–é¡¹ç›®
```bash
mkdir terky
cd terky
pnpm init
```
> æ–°å»º`pnpm-workspace.yaml`æ–‡ä»¶ï¼Œé…ç½®`packages`ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…
```yaml
packages:
  - 'packages/*'
```
å› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªè„šæ‰‹æ¶ï¼Œæ‰€ä»¥ä¸ä»…è¦æœ‰è„šæ‰‹æ¶åŒ…ï¼Œè¿˜è¦æœ‰æ¨¡æ¿åŒ…,è¿™æ˜¯æˆ‘çš„é¡¹ç›®ç›®å½•ç»“æ„
```plantuml
â”œâ”€packages
â”‚  â”œâ”€create-terky
â”‚  â”œâ”€template-react-ts
â”‚  â”œâ”€template-vue3-ts
â”‚  â”œâ”€template-vue3
â”‚  â””â”€template-vue2

```

### `eslint`
> æ­¤é…ç½®ä½œä¸ºåŸºç¡€é…ç½®ï¼Œä¼šè¢«`packages`ä¸‹çš„åŒ…ç»§æ‰¿
- eslint
`eslint`æ ¸å¿ƒåŒ…
- @typescript-eslint/parser
`eslint`è§£æå™¨ï¼Œç”¨äºè§£æ`typescript`ä»£ç 
- @typescript-eslint/eslint-plugin
`eslint`æ’ä»¶ï¼Œç”¨äºæ£€æŸ¥`typescript`ä»£ç 
```bash
pnpm add eslint -D -w
pnpm add @typescript-eslint/parser -D -w
pnpm add @typescript-eslint/eslint-plugin -D -w
```
> æ–°å»º`.eslintrc.json`æ–‡ä»¶ï¼Œé…ç½®`eslint`
```json
{
  "parser": "@typescript-eslint/parser",
  "env": {
    "es6": true
  },
  "extends": [
      "eslint:recommended",
      "plugin:@typescript-eslint/recommended"
  ],
  "parserOptions": {
    "sourceType": "module",
    "ecmaVersion": 2021
  },
  "rules": {

  }
}
```

### `commitè§„èŒƒ`

é¦–å…ˆå…¨å±€å®‰è£… `commitizen`ï¼Œè¿™æ ·å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨`cz`æˆ–`git cz`æ›¿ä»£`git commit`
```bash
pnpm add -g commitizen
```
ç›®å‰æœ‰å¾ˆå¤š`commit`å·¥å…·å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè§„èŒƒåŒ–`commit`æ ¼å¼ï¼Œå…³äº`commit`è§„èŒƒä½ å¯ä»¥ç‚¹å‡»è¿™é‡Œ[æŸ¥çœ‹](https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)
æ¨èä½¿ç”¨`cz-git`ï¼Œå®˜æ–¹æä¾›äº†`commit`è§„èŒƒæ¨¡ç‰ˆï¼Œä»¥åŠæ”¯æŒ`emoji`ã€ä¸­æ–‡è‹±æ–‡åŒè¯­ï¼Œè€Œä¸”å®˜ç½‘ä¹Ÿæ˜¯ä¸­æ–‡æè¿°
```bash
pnpm add cz-git -D -w
```
å…·ä½“å¦‚ä½•é…ç½®ï¼Œè¯·ç§»æ­¥å®˜ç½‘æ–‡æ¡£æŸ¥çœ‹ï¼Œå†™çš„å¾ˆæ¸…æ¥šï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©å–œæ¬¢çš„é…ç½®æ¨¡ç‰ˆç›´æ¥ä½¿ç”¨ï¼Œå»ºè®®æ­é…`commitlint`ä½¿ç”¨ã€‚å®‰è£…å®Œæˆåå‘`.commitlintrc.js`æ·»åŠ æ£€æµ‹è§„åˆ™
```json
{
  ...
  extends: ['@commitlint/config-conventional']
  ...
}
```
æ·»åŠ `scripts`è„šæœ¬å‘½ä»¤
```json
{
  "scripts": {
    "commitlint": "commitlint --config .commitlintrc.js -e -V"
  }
}
```
`commitlint`éœ€è¦æ­é…`husky`ï¼Œéœ€è¦æ·»åŠ commit-msg hooks
```bash
pnpm add husky @commitlint/{config-conventional,cli} -D -w
husky install
npx husky add .husky/commit-msg 'npm run commitlint'
```

